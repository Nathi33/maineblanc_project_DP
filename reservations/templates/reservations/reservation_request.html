{% extends "core/base.html" %}

{% load i18n static %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'css/contact.css' %}" />
{% endblock %}

{% block title %}{% trans "Contact | Camping Le Maine Blanc" %}{% endblock %}

{% block content %}
<section class="container py-5" role="region" aria-labelledby="contact-title">
    <div class="container-title text-center">
        <img src="{% static 'pictures/peindre.png' %}" alt="" loading="lazy" class="img-deco-left"/>
        <h1 id="contact-title" class="title-accommodations">{% trans "Nous contacter" %}</h1>
        <img src="{% static 'pictures/peindre.png' %}" alt="" loading="lazy" class="img-deco-right"/>
    </div>

    <p class="text-accommodation">
       {% trans "Vous avez une question ou souhaitez réserver ? Appelez-nous au" %} <a href="tel:+33557425281" class="tel-accommodation">{% trans "05 57 42 52 81" %}</a> {% trans "ou complétez simplement le formulaire ci-dessous, nous vous répondrons rapidement !" %}
    </p>

    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">

            {% if form.errors %}
            <div class="alert alert-danger" role="alert" style="border-radius: 8px; padding: 12px 16px;">
                <h3 class="mb-2"><img src="{% static 'pictures/attention.png' %}" alt="{% trans "Attention" %}" class="logo-form-info" style="width:25px; height:25px; margin-right:10px;"> {% trans "Veuillez corriger les erreurs suivantes :" %}</h3>
                <ul class="mb-0">
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li><strong>{{ field.label }} :</strong> {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-success" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}


            
            <form method="post" action='{% url "reservation_request" %}' novalidate>
                {% csrf_token %}
                <div class="row">
                    <!--Contact details -->
                    <div class="col-md-6">
                        <h2 class="title-form">{% trans "Vos coordonnées" %}</h2>

                        <div class="mb-3">
                            {{ form.name.label_tag }} <span class="text-danger">*</span>
                            {{ form.name }}
                            
                        </div>
                        <div class="mb-3">
                            {{ form.first_name.label_tag }} <span class="text-danger">*</span>
                            {{ form.first_name }}
                            
                        </div>
                        <div class="mb-3">
                            {{ form.address.label_tag }} <span class="text-danger">*</span>
                            {{ form.address }}
                        
                        </div>
                        <div class="mb-3">
                            {{ form.postal_code.label_tag }} <span class="text-danger">*</span>
                            {{ form.postal_code }}
                    
                        </div>
                        <div class="mb-3">
                            {{ form.city.label_tag }} <span class="text-danger">*</span>
                            {{ form.city }}
                            
                        </div>
                        <div class="mb-3">
                            {{ form.phone.label_tag }} <span class="text-danger">*</span>
                            {{ form.phone }}
                            
                        </div>
                        <div class="mb-3">
                            {{ form.email.label_tag }} <span class="text-danger">*</span>
                            {{ form.email }}
                            
                        </div>
                        <div class="mb-3">
                            {{ form.message.label_tag }} 
                            {{ form.message }}
                            
                        </div>
                    </div>

                    <!-- Reservation details -->
                    <div class="col-md-6">
                        <h2 class="title-form">{% trans "Détails de la réservation" %}</h2>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.start_date.label_tag }} <span class="text-danger">*</span>
                                {{ form.start_date }}
                                
                            </div>
                            <div class="col-md-6">
                                {{ form.end_date.label_tag }} <span class="text-danger">*</span>
                                {{ form.end_date }}
                              
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.accommodation_type.id_for_label }}" class="form-label">
                                {% trans "Type d'hébergement" %} <span class="text-danger">*</span>
                            </label>
                            {{ form.accommodation_type }}
                        </div>

                        <div class="mb-3 form-label-cached" id="tent-dimensions">
                            {{ form.tent_length.label_tag }} <span class="text-danger">*</span>
                            {{ form.tent_length }}
                            {{ form.tent_width.label_tag }} <span class="text-danger">*</span>
                            {{ form.tent_width }}
                        </div>

                        <div class="mb-3 form-label-cached" id="vehicle-length-container">
                            {{ form.vehicle_length.label_tag }} <span class="text-danger">*</span>
                            {{ form.vehicle_length }}
                        </div>

                        <div class="row mb-3">
                            <label class="form-label">{% trans "Nombre d'occupants" %} <span class="text-danger">*</span></label>

                            <div class="col-md-6 col-lg-3">
                                <label for="{{ form.adults.id_for_label }}" class="form-label">{% trans "Adultes" %}</label>
                                <select class="form-select" id="{{ form.adults.id_for_label }}" name="{{ form.adults.html_name }}" required>
                                    <option value="" disabled>{% trans "Sélectionner" %}</option>
                                    {% for val, label in form.adults.field.choices %}
                                        <option value="{{ val }}" {% if form.adults.value == val|stringformat:"s" %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select> 
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <label for="{{ form.children_over_8.id_for_label }}" class="form-label">{% trans "Enfants +8 ans" %}</label>
                                <select class="form-select" id="{{ form.children_over_8.id_for_label }}" name="{{ form.children_over_8.html_name }}" required>
                                    <option value="" disabled>{% trans "Sélectionner" %}</option>
                                    {% for val, label in form.children_over_8.field.choices %}
                                        <option value="{{ val }}" {% if form.children_over_8.value == val|stringformat:"s" %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <label for="{{ form.children_under_8.id_for_label }}" class="form-label">{% trans "Enfants -8 ans" %}</label>
                                <select class="form-select" id="{{ form.children_under_8.id_for_label }}" name="{{ form.children_under_8.html_name }}" required>
                                    <option value="" disabled>{% trans "Sélectionner" %}</option>
                                    {% for val, label in form.children_under_8.field.choices %}
                                        <option value="{{ val }}" {% if form.children_under_8.value == val|stringformat:"s" %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <label for="{{ form.pets.id_for_label }}" class="form-label">{% trans "Animaux" %}</label>
                                <select class="form-select" id="{{ form.pets.id_for_label }}" name="{{ form.pets.html_name }}" required>
                                    <option value="" disabled>{% trans "Sélectionner" %}</option>
                                    {% for val, label in form.pets.field.choices %}
                                        <option value="{{ val }}" {% if form.pets.value == val|stringformat:"s" %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">{% trans "Électricité" %} <span class="text-danger">*</span></label>
                            <div>
                                {% for radio in form.electricity %}
                                <div class="form-check form-check-inline">
                                        {{ radio.tag }}
                                        <label class="form-check-label" for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                                </div>
                                {% endfor %}
                                
                            </div>
                        </div>

                        <div class="mb-3" id="cable-length-container" style="display:none;">
                            <label for="cable_length" class="form-label">{% trans "Longueur du câble électrique (m)" %} <span class="text-danger">*</span></label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="cable_length" 
                                name="cable_length" 
                                min="1" 
                                step="0.1"
                                value="{{ form.cable_length.value|default_if_none:'' }}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">{% trans "Localisation du camping" %}</label>
                            <div class="ratio ratio-4x3">
                                <iframe 
                                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2546.836672914667!2d-0.4893340242588966!3d45.13958425503974!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x48002e3f944d6d01%3A0xb22125c18d297349!2sCamping%20Le%20Maine%20Blanc!5e1!3m2!1sfr!2sfr!4v1754593114884!5m2!1sfr!2sfr" 
                                    width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" 
                                    referrerpolicy="no-referrer-when-downgrade">
                                </iframe>
                            </div>
                        </div>
                    </div>
                </div>
                
                <p class="small text-muted mt-3">
                    <span class="text-danger">*</span> {% trans "Champs obligatoires" %}
                </p>

                <div class="text-center mt-4">
                    <button type="submit" class="btn">{% trans "Envoyer la demande" %}</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // --- Alerts ---
            const alerts = document.querySelectorAll(".alert");
            setTimeout(() => {
                alerts.forEach(alert => {
                    alert.style.transition = "opacity 0.5s ease";
                    alert.style.opacity = "0";
                    setTimeout(() => alert.remove(), 500);
                });
            }, 5000);

            // --- Accommodation ---
            const accommodationSelect = document.getElementById("{{ form.accommodation_type.id_for_label }}");
            const tentDimensions = document.getElementById("tent-dimensions");
            const vehicleLengthContainer = document.getElementById("vehicle-length-container");

            function toggleFields() {
                const selected = accommodationSelect.value;
                if (["tent", "car_tent"].includes(selected)) {
                    tentDimensions.style.display = "block";
                } else {
                    tentDimensions.style.display = "none";
                    document.getElementById("tent_length").value = "";
                    document.getElementById("tent_width").value = "";
                }

                if (["caravan", "fourgon", "van", "camping_car"].includes(selected)) {
                    vehicleLengthContainer.style.display = "block";
                } else {
                    vehicleLengthContainer.style.display = "none";
                    document.getElementById("vehicle_length").value = "";
                }
            }

            accommodationSelect.addEventListener("change", toggleFields);
            toggleFields();

            // --- Electricity ---
            const electricityRadios = document.querySelectorAll("input[name='{{ form.electricity.html_name }}']");
            const cableLengthContainer = document.getElementById("cable-length-container");

            function toggleCableLength() {
                const selected = document.querySelector("input[name='{{ form.electricity.html_name }}']:checked");
                if (selected && selected.value === "yes") {
                    cableLengthContainer.style.display = "block";
                } else {
                    cableLengthContainer.style.display = "none";
                    const cableInput = document.getElementById("cable_length");
                    if (cableInput && cableInput.value && selected && selected.value !== "yes") {
                        cableInput.value = "";
                    }
                }
            }

            toggleCableLength();
            electricityRadios.forEach(radio => {
                radio.addEventListener("change", toggleCableLength);
            });

            // --- Dates ---
            const startDateInput = document.getElementById("id_start_date");
            const endDateInput = document.getElementById("id_end_date");

            if (startDateInput && endDateInput) {
                const today = new Date().toISOString().split("T")[0];
                startDateInput.setAttribute("min", today);

                function updateEndDate() {
                    let arrival = startDateInput.value ? new Date(startDateInput.value) : new Date();
                    let nextDay = new Date(arrival);
                    nextDay.setDate(arrival.getDate() + 1);

                    const formatted = nextDay.toISOString().split("T")[0];
                    endDateInput.setAttribute("min", formatted);

                    if (endDateInput.value && endDateInput.value <= startDateInput.value) {
                        endDateInput.value = "";
                    }
                }

                updateEndDate();
                startDateInput.addEventListener("change", updateEndDate);
            }
        });

    </script>

</section>

{% endblock %}

